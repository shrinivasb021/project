// ---- NEW FEATURE: Manual Input + Summary ----
const historyTable = document.querySelector("#historyTable tbody");
const summaryText = document.getElementById("summaryText");
const submitBtn = document.getElementById("submitVitals");
const generatePdfBtn = document.getElementById("generatePdf");

// Load saved history
const loadHistory = () => {
  const entries = JSON.parse(localStorage.getItem("vitalsHistory") || "[]");
  historyTable.innerHTML = "";
  entries.forEach(e => {
    const row = document.createElement("tr");
    row.innerHTML = `<td>${e.time}</td><td>${e.hr}</td><td>${e.spo2}</td><td>${e.temp}</td><td>${e.status}</td>`;
    historyTable.prepend(row);
  });
};
loadHistory();

function generateSummary(hr, spo2, temp) {
  let summary = "";
  if (hr < 60) summary += "üíõ Low heart rate. ";
  else if (hr > 100) summary += "‚ù§Ô∏è High heart rate. ";
  else summary += "üíö Normal heart rate. ";

  if (spo2 < 95) summary += "ü©∏ Oxygen level is below ideal. ";
  else summary += "üí® Oxygen level good. ";

  if (temp > 37.5) summary += "üå°Ô∏è Slight fever detected.";
  else summary += "‚ùÑÔ∏è Temperature normal.";

  return summary;
}

// Handle Submit
submitBtn.addEventListener("click", () => {
  const hr = parseInt(document.getElementById("inputHR").value);
  const spo2 = parseInt(document.getElementById("inputSpO2").value);
  const temp = parseFloat(document.getElementById("inputTemp").value);
  if (!hr || !spo2 || !temp) {
    alert("Please enter all vitals.");
    return;
  }

  const summary = generateSummary(hr, spo2, temp);
  summaryText.innerHTML = `<b>Health Summary:</b> ${summary}`;

  const time = new Date().toLocaleTimeString();
  const entry = { time, hr, spo2, temp, status: summary };
  const entries = JSON.parse(localStorage.getItem("vitalsHistory") || "[]");
  entries.push(entry);
  if (entries.length > 5) entries.shift(); // keep last 5
  localStorage.setItem("vitalsHistory", JSON.stringify(entries));
  loadHistory();
});

// ---- PDF Export (Uses browser print to PDF) ----
generatePdfBtn.addEventListener("click", () => {
  const doc = window.open("", "_blank");
  doc.document.write(`
    <h2>Wearable Health Report</h2>
    <p><b>Time:</b> ${new Date().toLocaleString()}</p>
    <p><b>Heart Rate:</b> ${document.getElementById("inputHR").value} bpm</p>
    <p><b>SpO‚ÇÇ:</b> ${document.getElementById("inputSpO2").value}%</p>
    <p><b>Temperature:</b> ${document.getElementById("inputTemp").value} ¬∞C</p>
    <p>${summaryText.textContent}</p>
    <hr><p>Generated by Smart Wearable Health Dashboard ü©∫</p>
  `);
  doc.print();
});
